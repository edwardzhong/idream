function bindEvents(){$("#comment").on("click",".close",function(e){e.stopPropagation(),$(this).parent().hide(),$("#overlay").hide()}),$("#addTag").on("click",function(e){$(".tags").toggle()}),$("#replyComment").on("click",function(e){e.stopPropagation();var a=$("#commentText");if(!$.trim(a.html()))return a.addClass("flash"),void setTimeout(function(){a.removeClass("flash")},900);$("#loading").show(),$("#overlay").hide(),$("#comment").hide(),sendFn({r:"/feed/review",feed_id:FeedID,to_review_id:ReviewID,content:a.html()},function(e){$("#loading").hide(),200==e.code?(location.reload(),console.log(e)):showDialog({txt:e.msg,confirm:"确认"})})}),$(".comment-list,.view-article").on("click","[data-tag]",function(e){e.stopPropagation();var a=$(this);switch(name=a.data("tag"),rid=a.data("rid"),opts={},name){case"up":sendFn({r:"/feed/digg",feed_id:FeedID},function(e){$("#loading").hide(),200==e.code?(a.toggleClass("active"),console.log(e)):showDialog({txt:e.msg,confirm:"确认"})});break;case"more":hideDialogs();var t=$(this).siblings("[data-menu=more]");showDownMenu(t,$(this));break;case"share":hideDialogs();var t=$(this).siblings("[data-menu=share]");showDownMenu(t,$(this));break;case"delete":var a=$(this);showDialog("确定删除?",function(){a.parents("ul").length?sendFn({r:"/feed/del-review",feed_id:FeedID,review_id:rid},function(e){200==e.code?a.parentsUntil("ul").remove():showDialog({txt:e.msg,confirm:"确认"})}):sendFn({r:"/user/del",feed_id:FeedID},function(e){200==e.code?location.href="/":showDialog({txt:e.msg,confirm:"确认"})})});break;case"private":hideDialogs();var a=$(this),s=a.parentsUntil(".actions").siblings(".private"),i=Number(a.data("type"));sendFn({r:"/feed/set-feed-secret",feed_id:FeedID,show_type:3-i},function(e){200==e.code?(s.toggle(),a.data("type",3-i),a.html(["设为公开","设为私密"][i-1])):showDialog({txt:e.msg,confirm:"确认"})});break;case"collect":hideDialogs(),showDialog({txt:"已收藏",confirm:"确认"});break;case"copy":break;case"comment":var o=$(this).parents(".dream-wrap,.view-article");userNames=o.find(".title span"),"dream-wrap"==$(this).parent().parent()[0].className&&(o=$(this).parentsUntil(".comment-list").find(".dream-wrap").first());var r=o.offset().left,n=o.width();showComment(userNames,r,n),ReviewID=rid;break;case"facebook":if(showShare())break;generate("https://www.facebook.com/sharer/sharer.php?u=(sUrl)",getShareOpts.call(this));break;case"weibo":if(showShare())break;generate("http://service.weibo.com/share/share.php?url=(sUrl(&title=(sTitle)&pic=(sPic)",getShareOpts.call(this));break;case"douban":if(showShare())break;generate("https://www.douban.com/share/service?image=(sPic)&href=(sUrl)&name=(sTitle)&text=(sDesc)",getShareOpts.call(this));break;case"qq":if(showShare())break;generate("http://connect.qq.com/widget/shareqq/index.html?url=(sUrl)&title=(sTitle)&source=(sDesc)",getShareOpts.call(this));break;case"wechat":if(showShare())break;showWX(getShareOpts.call(this));break;case"whatsapp":if(showShare())break;generate("whatsapp://send?text=(sDesc)"+encodeURIComponent("\n\n")+"(sUrl)&via=lopscoop",getShareOpts.call(this))}})}var ReviewID="",viewer=new Viewer($("#viewImgs")[0],{minZoomRatio:.5,maxZoomRatio:3});setCopyUrl(),bindEvents();