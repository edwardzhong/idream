function bindEvents(){$(".article-list li").on("click","p",function(){$(this).addClass("show")}),$(".article-list li").on("dblclick","p",function(){$(this).removeClass("show")}),$("#comment").on("click",".close",function(e){e.stopPropagation(),$(this).parent().hide(),$("#overlay").hide()}),$(".article-list").on("click","[data-tag]",function(e){e.stopPropagation();var a=$(this);switch(name=a.data("tag"),fid=a.data("id"),opts={},name){case"up":sendFn({r:"/feed/digg",feed_id:fid},function(e){$("#loading").hide(),200==e.code?(a.toggleClass("active"),console.log(e)):showDialog({txt:e.msg,confirm:"确认"})});break;case"more":hideDialogs();var t=$(this).siblings("[data-menu=more]");showDownMenu(t,$(this));break;case"share":hideDialogs();var t=$(this).siblings("[data-menu=share]");showDownMenu(t,$(this));break;case"delete":var a=$(this);showDialog("确定删除?",function(){sendFn({r:"/user/del",feed_id:fid},function(e){200==e.code?a.parents("ul").length&&a.parentsUntil("ul").remove():showDialog({txt:e.msg,confirm:"确认"})})});break;case"private":hideDialogs();var a=$(this),i=a.parentsUntil(".actions").siblings(".private"),s=Number(a.data("type"));sendFn({r:"/feed/set-feed-secret",feed_id:fid,show_type:3-s},function(e){200==e.code?(i.toggle(),a.data("type",3-s),a.html(["设为公开","设为私密"][s-1])):showDialog({txt:e.msg,confirm:"确认"})});break;case"collect":hideDialogs(),showDialog({txt:"已收藏",confirm:"确认"});break;case"copy":break;case"comment":var o=$(this).parents(".dream-wrap"),n=o.find(".title span"),r=o.offset().left,l=o.width();showComment(n,r,l),FeedID=fid;break;case"facebook":if(showShare())break;generate("https://www.facebook.com/sharer/sharer.php?u=(sUrl)",getShareOpts.call(this));break;case"weibo":if(showShare())break;generate("http://service.weibo.com/share/share.php?url=(sUrl)&title=(sTitle)&pic=(sPic)",getShareOpts.call(this));break;case"douban":if(showShare())break;generate("https://www.douban.com/share/service?image=(sPic)&href=(sUrl)&name=(sTitle)&text=(sDesc)",getShareOpts.call(this));break;case"qq":if(showShare())break;generate("http://connect.qq.com/widget/shareqq/index.html?url=(sUrl)&title=(sTitle)&source=(sDesc)",getShareOpts.call(this));break;case"wechat":if(showShare())break;showWX(getShareOpts.call(this));break;case"whatsapp":if(showShare())break;generate("whatsapp://send?text=(sDesc)"+encodeURIComponent("\n\n")+"(sUrl)&via=lopscoop",getShareOpts.call(this))}})}function scrollPage(e){$(".middle").on("scroll",function(a){var t={page:pageNo+1,page_size:PageSize},i=$(".article-list"),s=$("#liTemp").html(),o=i.outerHeight(),n=($(this).offset().top,$(window).height()),r=$(this).scrollTop();$.extend(t,e),isLoading||isOver||n+r>o-100&&(isLoading=!0,sendFn(t,function(e){if(console.log(e),isLoading=!1,200==e.code){if(e.data&&e.data.feed&&e.data.feed.length){PageTotal=Number(e.data.count),isOver=pageNo*PageSize+e.data.feed.length>=PageTotal,pageNo++;var a=e.data.feed,t=[],o="";a=initList(a),a.forEach(function(e,a){if(e.content=replaceTopic(e.content,Topic),o=s.replace(/\(avatar\)/,e.avatar).replace(/\(uid\)/g,e.uid).replace(/\(publish_time\)/,e.publish_time).replace(/\(feed_id\)/g,e.feed_id).replace(/\(uname\)/g,e.uname).replace(/\(title\)/g,e.title).replace(/\(content\)/,e.content).replace(/\(digg_count\)/,e.digg_count).replace(/\(comment_count\)/,e.comment_count).replace(/\(show_type\)/,e.show_type||""),e.imgInfo&&e.imgInfo.length){var i=[];e.imgInfo.forEach(function(e){i.push('<div class="img"><img src="'+e+'" alt="avatar"></div>')}),o=o.replace(/\(imgs\)/,i.join(""))}else o=o.replace(/\(imgs\)/,"");o=1==e.has_digg?o.replace(/\(has_digg\)/,"active"):o.replace(/\(has_digg\)/,""),o=1==e.is_me?o.replace(/\(mstyle\)/,"inline"):o.replace(/\(mstyle\)/,"none"),o=e.show_type&&2==e.show_type?o.replace(/\(pstyle\)/,"inline").replace(/\(ptxt\)/,"公开"):o.replace(/\(pstyle\)/,"none").replace(/\(ptxt\)/,"私密"),t.push(o)}),i.append(t.join("")),setCopyUrl(),$(".article-list li").off(),setContent()}}else showDialog({txt:e.msg,confirm:"确认"})}))})}var FeedID=0,isLoading=!1,pageNo=1,isOver=FirstCount>=PageTotal;setCopyUrl(),bindEvents(),scrollPage({r:"/user/get-topic-list",topic_name:Topic});