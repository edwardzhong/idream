function restoreData(){var e=storage.get();e&&e.uid&&($("#title").val(e.title),$("#content").html(e.content),$("#editImgs").html(e.imgs),$("#tag").val(e.tags),$(".edit-wrap").find("span").hide())}function autoSave(){function e(){var t=$.trim($("#title").val()),a=$.trim($("#content").html()),i=$("#editImgs").html(),s=$.trim($("#tag").val());t&&a&&storage.save({uid:Suid,title:t,content:a,imgs:i,tags:s}),setTimeout(e,5e4)}setTimeout(e,5e4)}function bindEvents(){$("#editImgs").on("click","i",function(e){var t=$(this);showDialog("确定删除?",function(){t.parent().remove()})}),$("#addTag").on("click",function(e){$("#tag").toggle()}),$(".article-list li").on("click","p",function(){$(this).addClass("show")}),$(".article-list li").on("dblclick","p",function(){$(this).removeClass("show")}),$("#comment").on("click",".close",function(e){e.stopPropagation(),$(this).parent().hide(),$("#overlay").hide()}),$("#replyComment").on("click",function(e){e.stopPropagation();var t=$("#commentText");if(!$.trim(t.html()))return t.addClass("flash"),void setTimeout(function(){t.removeClass("flash")},900);$("#loading").show(),$("#overlay").hide(),$("#comment").hide(),sendFn({r:"/feed/review",feed_id:FeedID,content:t.html()},function(e){$("#loading").hide(),200==e.code?(location.reload(),console.log(e)):showDialog({txt:e.msg,confirm:"确认"})})}),$("#title").on(changeEvent,function(e){for(var t=this.value,a=0,i=0;i<t.length;i++)/[\u4e00-\u9fa5]/.test(t.charAt(i))&&a++;a>15?$(this).addClass("warn"):$(this).removeClass("warn")}),$("#submit").on("click",function(){var e=$("#title"),t=$("#content"),a=[],i=$("#tag").val();return $.trim(e.val())?(e.removeClass("warn"),$.trim(t.html())?(t.removeClass("warn"),$("#editImgs").find("img").each(function(e,t){a.push(t.src)}),$("#loading").show(),void sendFn({r:"/user/publish",title:e.val(),content:t.html(),img_url:a.join(","),tags:i},function(e){$("#loading").hide(),storage.clear(),200==e.code?location.reload():showDialog({txt:e.msg,confirm:"确认"})})):(t.addClass("warn"),void showDialog({txt:"内容不能为空",confirm:"确认"},function(){t.focus()}))):(e.addClass("warn"),void showDialog({txt:"标题不能为空",confirm:"确认"},function(){e.focus()}))}),$(".article-list,.view-article").on("click","[data-tag]",function(e){e.stopPropagation();var t=$(this);switch(name=t.data("tag"),fid=t.data("id"),opts={},name){case"up":sendFn({r:"/feed/digg",feed_id:fid},function(e){$("#loading").hide(),200==e.code?(t.toggleClass("active"),console.log(e)):showDialog({txt:e.msg,confirm:"确认"})});break;case"more":hideDialogs();var a=$(this).siblings("[data-menu=more]");showDownMenu(a,$(this));break;case"share":hideDialogs();var a=$(this).siblings("[data-menu=share]");showDownMenu(a,$(this));break;case"delete":var t=$(this);showDialog("确定删除?",function(){sendFn({r:"/user/del",feed_id:fid},function(e){200==e.code?t.parents("ul").length&&t.parentsUntil("ul").remove():showDialog({txt:e.msg,confirm:"确认"})})});break;case"private":hideDialogs();var t=$(this),i=t.parentsUntil(".actions").siblings(".private"),s=Number(t.data("type"));sendFn({r:"/feed/set-feed-secret",feed_id:fid,show_type:3-s},function(e){200==e.code?(i.toggle(),t.data("type",3-s),t.html(["设为公开","设为私密"][s-1])):showDialog({txt:e.msg,confirm:"确认"})});break;case"collect":hideDialogs(),showDialog({txt:"已收藏",confirm:"确认"});break;case"copy":break;case"comment":var o=$(this).parents(".dream-wrap"),n=o.find(".title span"),r=o.offset().left,l=o.width();showComment(n,r,l),FeedID=fid;break;case"facebook":if(showShare())break;generate("https://www.facebook.com/sharer/sharer.php?u=(sUrl)",getShareOpts.call(this));break;case"weibo":if(showShare())break;generate("http://service.weibo.com/share/share.php?url=(sUrl)&title=(sTitle)&pic=(sPic)",getShareOpts.call(this));break;case"douban":if(showShare())break;generate("https://www.douban.com/share/service?image=(sPic)&href=(sUrl)&name=(sTitle)&text=(sDesc)",getShareOpts.call(this));break;case"qq":if(showShare())break;generate("http://connect.qq.com/widget/shareqq/index.html?url=(sUrl)&title=(sTitle)&source=(sDesc)",getShareOpts.call(this));break;case"wechat":if(showShare())break;showWX(getShareOpts.call(this));break;case"whatsapp":if(showShare())break;generate("whatsapp://send?text=(sDesc)"+encodeURIComponent("\n\n")+"(sUrl)&via=lopscoop",getShareOpts.call(this))}})}var FeedID=0,storage=new Storage("addArticle"+Suid);restoreData(),autoSave(),uploadImage(),setCopyUrl(),bindEvents(),scrollPage({r:"/user/get-user-home",pagehas_img:HasImg||""});