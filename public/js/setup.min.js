function selectHash(o){if(location.hash.substr(1)!=o)return void(location.hash=o);var n=o.split("/"),a=n[0];a&&a in Actions?(activePage(a),Actions[a].apply(this,n),firstLoad=!1):selectHash("notice")}function activePage(o){$(".pages ."+o).show().siblings().hide(),$(".nav [data-tag="+o+"]").addClass("active").siblings(".active").removeClass("active")}var firstLoad=!0,Actions={about:function(){},notice:function(){},private:function(){},account:function(){},black:function(){}};$(window).on("hashchange",function(o){selectHash(location.hash.replace("#",""))}),selectHash(location.hash.substr(1)),$("#title").on(changeEvent,function(o){setTextWarn.call(this,this.value,7)}),$("#content").on(changeEvent,function(o){setTextWarn.call(this,this.innerHTML,150)}),$("#btnAbout").on("click",function(o){o.stopPropagation();var n=$("#title"),a=$("#content");return $.trim(n.val())?(n.removeClass("warn"),$.trim(a.html())?(a.removeClass("warn"),$("#loading").show(),void sendFn({r:"/userset/add-opinion",title:n.val(),content:a.html()},function(o){$("#loading").hide(),200==o.code?(n.val(""),a.empty(),a.next("span").show(),showDialog({txt:"提交成功",confirm:"确认"})):showDialog({txt:o.msg,confirm:"确认"})})):(a.addClass("warn"),void showDialog({txt:"内容不能为空",confirm:"确认"},function(){a.focus()}))):(n.addClass("warn"),void showDialog({txt:"关于不能为空",confirm:"确认"},function(){n.focus()}))}),$("[name=notice]").on("click",function(o){var n=1,a=1;$("[name=notice]").each(function(o,i){"comment"==i.id&&(n=i.checked?1:2),"ding"==i.id&&(a=i.checked?1:2),console.log(o)}),sendFn({r:"/userset/set-user-notice",is_review:n,is_digg:a},function(o){200!=o.code&&showDialog({txt:o.msg,confirm:"确认"})})}),$("[name=private]").on("click",function(o){var n=$("[name=private]:checked").data("show");sendFn({r:"/userset/set-secret",is_show:n},function(o){200!=o.code&&showDialog({txt:o.msg,confirm:"确认"})})}),$("#btnPass").on("click",function(o){o.stopPropagation();var n=$("#oldPass"),a=$("#newPass"),i=$("#comPass");return $.trim(n.val())?(n.removeClass("warn"),$.trim(a.val())?(a.removeClass("warn"),a.val()!=i.val()?(i.addClass("warn"),void showDialog({txt:"重设密码不一致",confirm:"确认"},function(){i.focus()})):(i.removeClass("warn"),$("#loading").show(),void sendFn({r:"/userset/change-pwd",oldpassword:n.val(),password:a.val(),repassword:i.val()},function(o){$("#loading").hide(),200==o.code?(n.val(""),a.val(""),i.val(""),showDialog({txt:"密码修改成功",confirm:"确认"})):showDialog({txt:o.msg,confirm:"确认"})}))):(a.addClass("warn"),void showDialog({txt:"新密码不能为空",confirm:"确认"},function(){a.focus()}))):(n.addClass("warn"),void showDialog({txt:"原密码不能为空",confirm:"确认"},function(){n.focus()}))}),$("#btnEmail").on("click",function(o){o.stopPropagation();var n=$("#email");return $.trim(n.val())?/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(n.val())?(n.removeClass("warn"),$("#loading").show(),void sendFn({r:"/userset/send-email-code",email:n.val()},function(o){$("#loading").hide(),200==o.code?showDialog({txt:"验证码已发送，请登录邮箱查看",confirm:"确认"}):showDialog({txt:o.msg,confirm:"确认"})})):(n.addClass("warn"),void showDialog({txt:"邮箱格式不正确",confirm:"确认"},function(){n.focus()})):(n.addClass("warn"),void showDialog({txt:"邮箱不能为空",confirm:"确认"},function(){n.focus()}))}),$("#btnSave").on("click",function(o){o.stopPropagation();var n=$("#code"),a=$("#newMail"),i=$("#comMail");return n.removeClass("warn"),a.removeClass("warn"),i.removeClass("warn"),$.trim(n.val())?$.trim(a.val())?/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(a.val())?a.val()!=i.val()?(i.addClass("warn"),void showDialog({txt:"确认邮箱与新邮箱不一致",confirm:"确认"},function(){i.focus()})):($("#loading").show(),void sendFn({r:"/userset/change-email",code:n.val(),newMail:a.val(),reMail:i.val()},function(o){$("#loading").hide(),200==o.code?(n.val(""),a.val(""),i.val(""),showDialog({txt:"更改登录邮箱成功",confirm:"确认"})):showDialog({txt:o.msg,confirm:"确认"})})):(a.addClass("warn"),void showDialog({txt:"邮箱格式不正确",confirm:"确认"},function(){a.focus()})):(a.addClass("warn"),void showDialog({txt:"新邮箱不能为空",confirm:"确认"},function(){a.focus()})):(n.addClass("warn"),void showDialog({txt:"验证码不能未空",confirm:"确认"},function(){n.focus()}))}),$(".black-list").on("click","[data-tag=black]",function(o){var n=$(this).parents("li"),a=$(this).data("id");showDialog("取消黑名单?",function(){sendFn({r:"/userset/del-black",black_uid:a},function(o){200==o.code?n.remove():showDialog({txt:o.msg,confirm:"确认"})})})});